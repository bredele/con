#!/usr/bin/env node


/**
 * Module dependencies.
 * @api private
 */

var fs = require('fs');
var read = fs.readFileSync;
var write = fs.writeFileSync;
var resolve = require('path').resolve;
var program = require('commander');
var utils = require('../utils/utils');
var command = require('./command');
var pretty = require('prettyjson');
var commands = [
 'get',
 'set',
 'enable',
 'disable',
 'bump'
];



/**
 * Usage.
 */

program
  .version(require('../package.json').version)
  .usage('[<file>]');



/**
 * Examples.
 */

program.on('--help', function () {
  console.log('  Examples:');  
  console.log();
  console.log('    # get name attribute:');
  console.log('    $ con file.json get name');
  console.log();
  console.log('    # set name attribute:');
  console.log('    $ con file.json set name bredele');
  console.log();
  console.log('    # enable awesome attribute:');
  console.log('    $ con file.json enable awesome');
  console.log();
  console.log('    # disable awesome attribute:');
  console.log('    $ con file.json disable awesome');
  console.log();
  console.log('    # bump version');
  console.log('    $ con file.json bump');


});


/**
 * Parse.
 */

program.parse(process.argv);



/**
 * Settings.
 */

var name = program.args.splice(0,1)[0];


var path = resolve('.', name);

try {
  var file = require(path);
} catch (e) {
	utils.fatal( name + " is not a json file");
}

if(commands.indexOf(program.args[0]) > -1) {
	console.log();
	write(path, command.apply(null, [file].concat(program.args)));
	console.log();
	process.exit();
} 
console.log();
console.log(pretty.render(file, {
	keysColor: 'blue',
  dashColor: 'magenta',
  stringColor: 'grey'
}));
process.exit();


